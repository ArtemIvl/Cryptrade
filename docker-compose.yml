version: '3.4'

networks:
  backend:
  frontend:

services:
  usermanagement:
    container_name: usermanagement
    image: ${DOCKER_REGISTRY-}usermanagement
    build:
      context: ./CryptradeBack
      dockerfile: UserManagement/Dockerfile
    networks:
      - backend
      - frontend
    ports:
      - 8003:443

  portfoliomanagement:
    container_name: portfoliomanagement
    image: ${DOCKER_REGISTRY-}portfoliomanagement
    build:
      context: ./CryptradeBack
      dockerfile: PortfolioManagement/Dockerfile
    networks:
      - backend
      - frontend
    ports:
      - 8004:443

  cryptocurrencydata:
    container_name: cryptocurrencydata
    image: ${DOCKER_REGISTRY-}cryptocurrencydata
    build:
      context: ./CryptradeBack
      dockerfile: CryptocurrencyData/Dockerfile
    networks:
      - backend
      - frontend
    ports:
      - 8005:443

  transactionmanagement:
    container_name: transactionmanagement
    image: ${DOCKER_REGISTRY-}transactionmanagement
    build:
      context: ./CryptradeBack
      dockerfile: TransactionManagement/Dockerfile
    networks:
      - backend
      - frontend
    ports:
      - 8006:443
  
  rabbitmq:
    container_name: rabbitmq
    hostname: rabbitmq
    image: "rabbitmq:3.12.10-management"
    networks:
      - backend
    ports:
      - "5672:5672"  # AMQP port
      - "15672:15672"  # RabbitMQ management interface

  cryptradefront:
    container_name: cryptradefront
    image: ${DOCKER_REGISTRY-}cryptradefront
    build:
      context: ./cryptradefront
      dockerfile: Dockerfile
    networks:
      - frontend
    ports:
      - 8002:3000
