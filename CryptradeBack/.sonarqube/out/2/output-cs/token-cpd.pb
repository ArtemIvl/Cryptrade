æ,
c/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Controllers/CryptoController.cs
	namespace 	
CryptocurrencyData
 
. 
Controllers (
{ 
[ 
Route 

(
 
$str 
) 
] 
[		 
ApiController		 
]		 
public

 

class

 
CryptoController

 !
:

" #
ControllerBase

$ 2
{ 
private 
readonly 
CryptoService &
_cryptoService' 5
;5 6
public 
CryptoController 
(  
CryptoService  -
cryptoService. ;
); <
{ 	
_cryptoService 
= 
cryptoService *
;* +
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetCryptoData) 6
(6 7
)7 8
{ 	
try 
{ 
var 

cryptoData 
=  
await! &
_cryptoService' 5
.5 6
GetCryptoDataAsync6 H
(H I
)I J
;J K
return 
Ok 
( 

cryptoData $
)$ %
;% &
} 
catch 
( 
	Exception 
ex 
)  
{ 
return 

StatusCode !
(! "
$num" %
,% &
new' *
{+ ,
message- 4
=5 6
$str7 _
+` a
exb d
.d e
ToStringe m
(m n
)n o
}p q
)q r
;r s
} 
}   	
["" 	
HttpGet""	 
("" 
$str"" +
)""+ ,
]"", -
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
SortByPriceChange##) :
(##: ;
)##; <
{$$ 	
var%% 

sortedData%% 
=%% 
await%% "
_cryptoService%%# 1
.%%1 2'
SortByPriceChangeDescending%%2 M
(%%M N
)%%N O
;%%O P
return&& 
Ok&& 
(&& 

sortedData&&  
)&&  !
;&&! "
}'' 	
[)) 	
HttpGet))	 
()) 
$str)) ,
))), -
]))- .
public** 
async** 
Task** 
<** 
IActionResult** '
>**' (
SortByVolume24h**) 8
(**8 9
)**9 :
{++ 	
var,, 

sortedData,, 
=,, 
await,, "
_cryptoService,,# 1
.,,1 2%
SortByVolume24hDescending,,2 K
(,,K L
),,L M
;,,M N
return-- 
Ok-- 
(-- 

sortedData--  
)--  !
;--! "
}.. 	
[00 	
HttpGet00	 
(00 
$str00  
)00  !
]00! "
public11 
async11 
Task11 
<11 
IActionResult11 '
>11' (
SearchCrypto11) 5
(115 6
[116 7
	FromQuery117 @
]11@ A
string11B H

searchTerm11I S
)11S T
{22 	
try33 
{44 
var55 
searchRsult55 
=55  !
await55" '
_cryptoService55( 6
.556 7
SearchCrypto557 C
(55C D

searchTerm55D N
)55N O
;55O P
return66 
Ok66 
(66 
searchRsult66 %
)66% &
;66& '
}77 
catch88 
(88 
	Exception88 
ex88 
)88  
{99 
return:: 

StatusCode:: !
(::! "
$num::" %
,::% &
new::' *
{::+ ,
message::- 4
=::5 6
$str::7 L
+::M N
ex::O Q
.::Q R
ToString::R Z
(::Z [
)::[ \
}::] ^
)::^ _
;::_ `
};; 
}<< 	
[>> 	
HttpGet>>	 
(>> 
$str>> 
)>> 
]>> 
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
GetCryptoBySymbol??) :
(??: ;
string??; A
symbol??B H
)??H I
{@@ 	
tryAA 
{BB 
varCC 
cryptoResultCC  
=CC! "
awaitCC# (
_cryptoServiceCC) 7
.CC7 8
GetCryptoBySymbolCC8 I
(CCI J
symbolCCJ P
)CCP Q
;CCQ R
ifEE 
(EE 
cryptoResultEE  
==EE! #
nullEE$ (
)EE( )
{FF 
returnGG 
NotFoundGG #
(GG# $
$strGG$ ?
)GG? @
;GG@ A
}HH 
returnJJ 
OkJJ 
(JJ 
cryptoResultJJ &
)JJ& '
;JJ' (
}KK 
catchLL 
(LL 
	ExceptionLL 
exLL 
)LL  
{MM 
returnNN 

StatusCodeNN !
(NN! "
$numNN" %
,NN% &
newNN' *
{NN+ ,
messageNN- 4
=NN5 6
$strNN7 L
+NNM N
exNNO Q
.NNQ R
ToStringNNR Z
(NNZ [
)NN[ \
}NN] ^
)NN^ _
;NN_ `
}OO 
}PP 	
}QQ 
}RR ù
[/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Data/CryptoDbContext.cs
	namespace 	
CryptocurrencyData
 
. 
Data !
{ 
public		 
class		 
CryptoDbContext		 
:		 
	DbContext		  )
{

 
public 
CryptoDbContext 
( 
DbContextOptions /
</ 0
CryptoDbContext0 ?
>? @
optionsA H
)H I
:J K
baseL P
(P Q
optionsQ X
)X Y
{ 	
try 
{ 
var 
databaseCreator #
=$ %
Database& .
.. /

GetService/ 9
<9 :
IDatabaseCreator: J
>J K
(K L
)L M
asN P%
RelationalDatabaseCreatorQ j
;j k
if 
( 
databaseCreator #
!=$ &
null' +
)+ ,
{ 
if 
( 
! 
databaseCreator (
.( )

CanConnect) 3
(3 4
)4 5
)5 6
databaseCreator7 F
.F G
CreateG M
(M N
)N O
;O P
if 
( 
! 
databaseCreator (
.( )
	HasTables) 2
(2 3
)3 4
)4 5
databaseCreator6 E
.E F
CreateTablesF R
(R S
)S T
;T U
} 
} 
catch 
( 
	Exception 
ex 
)  
{ 
throw 
new 
	Exception #
(# $
ex$ &
.& '
ToString' /
(/ 0
)0 1
)1 2
;2 3
} 
} 	
public 
DbSet 
< 

CryptoData 
>  

CryptoData! +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
} 
} §
\/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Entity/Cryptocurrency.cs
	namespace 	
CryptocurrencyData
 
. 
Entity #
{ 
public 
class 
Cryptocurrency 
{ 
public 
int	 
id 
{ 
get 
; 
set 
; 
} 
public		 
string			 
name		 
{		 
get		 
;		 
set		 
;		  
}		! "
public

 
string

	 
symbol

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 
string	 
slug 
{ 
get 
; 
set 
;  
}! "
public 
int	 
cmc_rank 
{ 
get 
; 
set  
;  !
}" #
public 
double 
circulating_supply (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
double 
total_supply "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
double 
? 

max_supply !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
bool 
infinite_supply #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
string 
last_updated "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
string 

date_added  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
Quote 
quote 
{ 
get  
;  !
set" %
;% &
}' (
} 
public 

class 
Quote 
{ 
public 
USD 
usd 
{ 
get 
; 
set !
;! "
}# $
} 
public 

class 
USD 
{ 
public 
double 
price 
{ 
get !
;! "
set# &
;& '
}( )
public 
double 

volume_24h  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
double 
volume_change_24h '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public   
double   
percent_change_24h   (
{  ) *
get  + .
;  . /
set  0 3
;  3 4
}  5 6
public!! 
double!! 

market_cap!!  
{!!! "
get!!# &
;!!& '
set!!( +
;!!+ ,
}!!- .
}"" 
public$$ 

class$$ 
CryptoApiResponse$$ "
{%% 
public&& 
List&& 
<&& 
Cryptocurrency&& "
>&&" #
Data&&$ (
{&&) *
get&&+ .
;&&. /
set&&0 3
;&&3 4
}&&5 6
}'' 
}(( Å
X/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Entity/CryptoData.cs
	namespace 	
CryptocurrencyData
 
. 
Entity #
{ 
[ 
Table 

(
 
$str 
) 
] 
public 
class 

CryptoData 
{		 
[

 
Key

 
]

 
[ 
Column 	
(	 

$str
 
) 
] 
public 
int	 
id 
{ 
get 
; 
set 
; 
} 
[ 	
Column	 
( 
$str 
) 
] 
public 
string 
name 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Column	 
( 
$str 
) 
] 
public 
string 
symbol 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Column	 
( 
$str 
) 
] 
public 
double 
price 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Column	 
( 
$str 
) 
] 
public 
double 
	marketCap 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Column	 
( 
$str 
) 
] 
public 
double 
	volume24h 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Column	 
( 
$str "
)" #
]# $
public 
double 
percentChange24h &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[   	
Column  	 
(   
$str   #
)  # $
]  $ %
public!! 
double!! 
?!! 
circulatingSupply!! (
{!!) *
get!!+ .
;!!. /
set!!0 3
;!!3 4
}!!5 6
[## 	
Column##	 
(## 
$str## 
)## 
]## 
public$$ 
int$$ 
?$$ 
cmcRank$$ 
{$$ 
get$$ !
;$$! "
set$$# &
;$$& '
}$$( )
[&& 	
Column&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
DateTime'' 
lastUpdated'' #
{''$ %
get''& )
;'') *
set''+ .
;''. /
}''0 1
}(( 
})) Ë%
n/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Migrations/20231027172456_InitialCreate.cs
	namespace 	
CryptocurrencyData
 
. 

Migrations '
{ 
public

 

partial

 
class

 
InitialCreate

 &
:

' (
	Migration

) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
AlterDatabase *
(* +
)+ ,
. 

Annotation 
( 
$str +
,+ ,
$str- 6
)6 7
;7 8
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{ 
id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ C
,C D(
MySqlValueGenerationStrategyE a
.a b
IdentityColumnb p
)p q
,q r
name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 @
,@ A
nullableB J
:J K
falseL Q
)Q R
. 

Annotation #
(# $
$str$ 3
,3 4
$str5 >
)> ?
,? @
symbol 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 B
,B C
nullableD L
:L M
falseN S
)S T
. 

Annotation #
(# $
$str$ 3
,3 4
$str5 >
)> ?
,? @
price 
= 
table !
.! "
Column" (
<( )
double) /
>/ 0
(0 1
type1 5
:5 6
$str7 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
	marketCap 
= 
table  %
.% &
Column& ,
<, -
double- 3
>3 4
(4 5
type5 9
:9 :
$str; C
,C D
nullableE M
:M N
falseO T
)T U
,U V
	volume24h 
= 
table  %
.% &
Column& ,
<, -
double- 3
>3 4
(4 5
type5 9
:9 :
$str; C
,C D
nullableE M
:M N
falseO T
)T U
,U V
percentChange24h $
=% &
table' ,
., -
Column- 3
<3 4
double4 :
>: ;
(; <
type< @
:@ A
$strB J
,J K
nullableL T
:T U
falseV [
)[ \
,\ ]
lastUpdated   
=    !
table  " '
.  ' (
Column  ( .
<  . /
DateTime  / 7
>  7 8
(  8 9
type  9 =
:  = >
$str  ? L
,  L M
nullable  N V
:  V W
false  X ]
)  ] ^
}!! 
,!! 
constraints"" 
:"" 
table"" "
=>""# %
{## 
table$$ 
.$$ 

PrimaryKey$$ $
($$$ %
$str$$% 4
,$$4 5
x$$6 7
=>$$8 :
x$$; <
.$$< =
id$$= ?
)$$? @
;$$@ A
}%% 
)%% 
.&& 

Annotation&& 
(&& 
$str&& +
,&&+ ,
$str&&- 6
)&&6 7
;&&7 8
}'' 	
	protected** 
override** 
void** 
Down**  $
(**$ %
MigrationBuilder**% 5
migrationBuilder**6 F
)**F G
{++ 	
migrationBuilder,, 
.,, 
	DropTable,, &
(,,& '
name-- 
:-- 
$str-- "
)--" #
;--# $
}.. 	
}// 
}00 Ä1
N/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddControllers

 
(

  
)

  !
;

! "
var 
dbHost 

= 
Environment 
. "
GetEnvironmentVariable /
(/ 0
$str0 9
)9 :
;: ;
var 
dbName 

= 
Environment 
. "
GetEnvironmentVariable /
(/ 0
$str0 9
)9 :
;: ;
var 

dbPassword 
= 
Environment 
. "
GetEnvironmentVariable 3
(3 4
$str4 F
)F G
;G H
var 
connectionString 
= 
$" 
$str  
{  !
dbHost! '
}' (
$str( <
{< =
dbName= C
}C D
$strD X
{X Y

dbPasswordY c
}c d
"d e
;e f
builder 
. 
Services 
. 
AddDbContext 
< 
CryptoDbContext -
>- .
(. /
options/ 6
=>7 9
options 
. 
UseMySql 
( 
connectionString %
,% &
new' *
MySqlServerVersion+ =
(= >
new> A
VersionB I
(I J
$numJ K
,K L
$numM N
,N O
$numP Q
)Q R
)R S
)S T
)T U
;U V
builder 
. 
Services 
. 
AddAuthentication "
(" #-
!CertificateAuthenticationDefaults )
.) * 
AuthenticationScheme* >
)> ?
. 
AddCertificate 
( 
) 
; 
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
var!! 
config!! 

=!! 
new!!  
ConfigurationBuilder!! %
(!!% &
)!!& '
."" 
SetBasePath"" 
("" 
	Directory"" 
."" 
GetCurrentDirectory"" .
("". /
)""/ 0
)""0 1
.## 
AddJsonFile## 
(## 
$str## #
)### $
.$$ 
Build$$ 

($$
 
)$$ 
;$$ 
builder&& 
.&& 
Services&& 
.&& 
AddSingleton&& 
<&& 
IConfiguration&& ,
>&&, -
(&&- .
config&&. 4
)&&4 5
;&&5 6
builder'' 
.'' 
Services'' 
.'' 
	AddScoped'' 
<'' 
RabbitMQService'' *
>''* +
(''+ ,
)'', -
;''- .
builder(( 
.(( 
Services(( 
.(( 
	AddScoped(( 
<(( 
CryptoService(( (
>((( )
((() *
)((* +
;((+ ,
builder)) 
.)) 
Services)) 
.)) 
AddHttpClient)) 
<)) 
CryptoService)) ,
>)), -
())- .
))). /
;))/ 0
builder,, 
.,, 
Services,, 
.,, 
AddCors,, 
(,, 
options,,  
=>,,! #
{-- 
options.. 
... 
	AddPolicy.. 
(.. 
$str.. *
,..* +
builder// 
=>// 
builder// 
.00 
WithOrigins00 
(00 
$str00 0
)000 1
.11 
AllowAnyHeader11 
(11 
)11 
.22 
AllowAnyMethod22 
(22 
)22 
)22 
;22 
}33 
)33 
;33 
builder55 
.55 
Services55 
.55 
AddCors55 
(55 
options55  
=>55! #
{66 
options77 
.77 
	AddPolicy77 
(77 
$str77 *
,77* +
builder88 
=>88 
builder88 
.99 
WithOrigins99 
(99 
$str99 0
)990 1
.:: 
AllowAnyHeader:: 
(:: 
):: 
.;; 
AllowAnyMethod;; 
(;; 
);; 
);; 
;;; 
}<< 
)<< 
;<< 
var>> 
app>> 
=>> 	
builder>>
 
.>> 
Build>> 
(>> 
)>> 
;>> 
appAA 
.AA 
UseCorsAA 
(AA 
$strAA  
)AA  !
;AA! "
appBB 
.BB 
UseCorsBB 
(BB 
$strBB  
)BB  !
;BB! "
ifEE 
(EE 
appEE 
.EE 
EnvironmentEE 
.EE 
IsDevelopmentEE !
(EE! "
)EE" #
)EE# $
{FF 
appGG 
.GG 

UseSwaggerGG 
(GG 
)GG 
;GG 
appHH 
.HH 
UseSwaggerUIHH 
(HH 
)HH 
;HH 
}II 
appKK 
.KK 
UseHttpsRedirectionKK 
(KK 
)KK 
;KK 
appMM 
.MM 
UseAuthenticationMM 
(MM 
)MM 
;MM 
appOO 
.OO 
UseAuthorizationOO 
(OO 
)OO 
;OO 
appQQ 
.QQ 
MapControllersQQ 
(QQ 
)QQ 
;QQ 
appSS 
.SS 
RunSS 
(SS 
)SS 	
;SS	 
´}
]/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Services/CryptoService.cs
	namespace 	
CryptocurrencyData
 
. 
Services %
{ 
public 
class 
CryptoService 
{		 
private

 	
readonly


 

HttpClient

 
_httpClient

 )
;

) *
private 
readonly 
string 
_apiKey  '
;' (
private 
readonly 
string 
_baseUrl  (
;( )
private 
readonly 
CryptoDbContext (
_context) 1
;1 2
private 
readonly 
RabbitMQService (
_rabbitMQService) 9
;9 :
public 
CryptoService 
( 

HttpClient '

httpClient( 2
,2 3
IConfiguration4 B
configurationC P
,P Q
CryptoDbContextR a
contextb i
,i j
RabbitMQServicek z
rabbitMQService	{ 
)
 
{ 	
_httpClient 
= 

httpClient $
;$ %
_apiKey 
= 
configuration #
[# $
$str$ @
]@ A
;A B
_baseUrl 
= 
configuration $
[$ %
$str% B
]B C
;C D
_context 
= 
context 
; 
_rabbitMQService 
= 
rabbitMQService .
;. /
} 	
public 
async 
Task 
< 
List 
< 

CryptoData )
>) *
>* +
GetCryptoDataAsync, >
(> ?
)? @
{ 	
try 
{ 
var 

cachedData 
=  
await! &
_context' /
./ 0

CryptoData0 :
.: ;
ToListAsync; F
(F G
)G H
;H I
if 
( 

cachedData 
!= !
null" &
&&' )

cachedData* 4
.4 5
Any5 8
(8 9
d9 :
=>; =
!> ?
IsDataStale? J
(J K
dK L
.L M
lastUpdatedM X
)X Y
)Y Z
)Z [
{ 
return   

cachedData   %
.  % &
ToList  & ,
(  , -
)  - .
;  . /
}!! 
else!! 
{"" 
var## 
freshDataList## %
=##& '
await##( - 
GetCryptoDataFromApi##. B
(##B C
)##C D
;##D E
await$$ 
CacheCryptoData$$ )
($$) *
freshDataList$$* 7
)$$7 8
;$$8 9
return%% 
freshDataList%% (
;%%( )
}&& 
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
throw** 
ex** 
;** 
}++ 
},, 	
public00 
async00 
Task00 
<00 
List00 
<00 

CryptoData00 )
>00) *
>00* + 
GetCryptoDataFromApi00, @
(00@ A
)00A B
{11 	
try22 
{33 
var44 
url44 
=44 
$"44 
{44 
_baseUrl44 %
}44% &
$str44& V
{44V W
_apiKey44W ^
}44^ _
"44_ `
;44` a
var55 
response55 
=55 
await55 $
_httpClient55% 0
.550 1
GetAsync551 9
(559 :
url55: =
)55= >
;55> ?
response66 
.66 #
EnsureSuccessStatusCode66 0
(660 1
)661 2
;662 3
var88 
content88 
=88 
await88 #
response88$ ,
.88, -
Content88- 4
.884 5
ReadAsStringAsync885 F
(88F G
)88G H
;88H I
var99 
cryptoResponse99 "
=99# $
JsonSerializer99% 3
.993 4
Deserialize994 ?
<99? @
CryptoApiResponse99@ Q
>99Q R
(99R S
content99S Z
,99Z [
new99\ _!
JsonSerializerOptions99` u
{:: '
PropertyNameCaseInsensitive;; /
=;;0 1
true;;2 6
}<< 
)<< 
;<< 
var>> 
freshDataList>> !
=>>" #
cryptoResponse>>$ 2
?>>2 3
.>>3 4
Data>>4 8
.>>8 9
Select>>9 ?
(>>? @
	freshData>>@ I
=>>>J L
new>>M P

CryptoData>>Q [
{?? 
name@@ 
=@@ 
	freshData@@ $
.@@$ %
name@@% )
,@@) *
symbolAA 
=AA 
	freshDataAA &
.AA& '
symbolAA' -
,AA- .
priceBB 
=BB #
RoundToTwoDecimalPlacesBB 3
(BB3 4
	freshDataBB4 =
.BB= >
quoteBB> C
.BBC D
usdBBD G
.BBG H
priceBBH M
)BBM N
,BBN O
	marketCapCC 
=CC #
RoundToTwoDecimalPlacesCC  7
(CC7 8
	freshDataCC8 A
.CCA B
quoteCCB G
.CCG H
usdCCH K
.CCK L

market_capCCL V
)CCV W
,CCW X
	volume24hDD 
=DD #
RoundToTwoDecimalPlacesDD  7
(DD7 8
	freshDataDD8 A
.DDA B
quoteDDB G
.DDG H
usdDDH K
.DDK L

volume_24hDDL V
)DDV W
,DDW X
percentChange24hEE $
=EE% &#
RoundToTwoDecimalPlacesEE' >
(EE> ?
	freshDataEE? H
.EEH I
quoteEEI N
.EEN O
usdEEO R
.EER S
percent_change_24hEES e
)EEe f
,EEf g
circulatingSupplyFF %
=FF& '#
RoundToTwoDecimalPlacesFF( ?
(FF? @
	freshDataFF@ I
.FFI J
circulating_supplyFFJ \
)FF\ ]
,FF] ^
cmcRankGG 
=GG 
	freshDataGG '
.GG' (
cmc_rankGG( 0
,GG0 1
lastUpdatedHH 
=HH  !
DateTimeHH" *
.HH* +
NowHH+ .
}II 
)II 
.II 
ToListII 
(II 
)II 
;II 
returnKK 
freshDataListKK $
;KK$ %
}LL 
catchMM 
(MM 
	ExceptionMM 
exMM 
)MM  
{NN 
throwPP 
exPP 
;PP 
}QQ 
}RR 	
publicUU 
asyncUU 
TaskUU 
CacheCryptoDataUU )
(UU) *
ListUU* .
<UU. /

CryptoDataUU/ 9
>UU9 :
freshDataListUU; H
)UUH I
{VV 	
tryWW 
{XX 
foreachYY 
(YY 
varYY 
	freshDataYY &
inYY' )
freshDataListYY* 7
)YY7 8
{ZZ 
var[[ 
existingData[[ $
=[[% &
await[[' ,
_context[[- 5
.[[5 6

CryptoData[[6 @
.[[@ A
FirstOrDefaultAsync[[A T
([[T U
d[[U V
=>[[W Y
d[[Z [
.[[[ \
symbol[[\ b
==[[c e
	freshData[[f o
.[[o p
symbol[[p v
)[[v w
;[[w x
if]] 
(]] 
existingData]] $
==]]% '
null]]( ,
)]], -
{^^ 
_context__  
.__  !

CryptoData__! +
.__+ ,
Add__, /
(__/ 0
	freshData__0 9
)__9 :
;__: ;
}`` 
elseaa 
{bb 
existingDatadd $
.dd$ %
namedd% )
=dd* +
	freshDatadd, 5
.dd5 6
namedd6 :
;dd: ;
existingDataee $
.ee$ %
symbolee% +
=ee, -
	freshDataee. 7
.ee7 8
symbolee8 >
;ee> ?
existingDataff $
.ff$ %
priceff% *
=ff+ ,
	freshDataff- 6
.ff6 7
priceff7 <
;ff< =
existingDatagg $
.gg$ %
	marketCapgg% .
=gg/ 0
	freshDatagg1 :
.gg: ;
	marketCapgg; D
;ggD E
existingDatahh $
.hh$ %
	volume24hhh% .
=hh/ 0
	freshDatahh1 :
.hh: ;
	volume24hhh; D
;hhD E
existingDataii $
.ii$ %
percentChange24hii% 5
=ii6 7
	freshDataii8 A
.iiA B
percentChange24hiiB R
;iiR S
existingDatajj $
.jj$ %
circulatingSupplyjj% 6
=jj7 8
	freshDatajj9 B
.jjB C
circulatingSupplyjjC T
;jjT U
existingDatakk $
.kk$ %
cmcRankkk% ,
=kk- .
	freshDatakk/ 8
.kk8 9
cmcRankkk9 @
;kk@ A
existingDatall $
.ll$ %
lastUpdatedll% 0
=ll1 2
DateTimell3 ;
.ll; <
Nowll< ?
;ll? @
}mm 
}nn 
awaitpp 
_contextpp 
.pp 
SaveChangesAsyncpp /
(pp/ 0
)pp0 1
;pp1 2
varss 
jsonDatass 
=ss 

Newtonsoftss )
.ss) *
Jsonss* .
.ss. /
JsonConvertss/ :
.ss: ;
SerializeObjectss; J
(ssJ K
freshDataListssK X
)ssX Y
;ssY Z
_rabbitMQServicevv  
.vv  !
PublishMessagevv! /
(vv/ 0
jsonDatavv0 8
)vv8 9
;vv9 :
}ww 
catchxx 
(xx 
	Exceptionxx 
exxx 
)xx  
{yy 
throwzz 
exzz 
;zz 
}{{ 
}|| 	
private~~ 
double~~ #
RoundToTwoDecimalPlaces~~ .
(~~. /
double~~/ 5
?~~5 6
value~~7 <
)~~< =
{ 	
const
 
double
 
	threshold
 "
=
# $
$num
% )
;
) *
if
 
(
 
value
 
.
 
HasValue
 
)
 
{
 
if
 
(
 
Math
 
.
 
Abs
 
(
 
value
 "
.
" #
Value
# (
)
( )
<
* +
	threshold
, 5
)
5 6
{
 
return
 
Math
 
.
  
Round
  %
(
% &
value
& +
.
+ ,
Value
, 1
,
1 2
$num
3 5
,
5 6
MidpointRounding
7 G
.
G H
AwayFromZero
H T
)
T U
;
U V
}
 
return
 
Math
 
.
 
Round
 !
(
! "
value
" '
.
' (
Value
( -
,
- .
$num
/ 0
,
0 1
MidpointRounding
2 B
.
B C
AwayFromZero
C O
)
O P
;
P Q
}
 
return
 
$num
 
;
 
}
 	
private
 
bool
 
IsDataStale
  
(
  !
DateTime
! )
lastUpdated
* 5
)
5 6
{
 	
return
 
(
 
DateTime
 
.
 
Now
  
-
! "
lastUpdated
# .
)
. /
>
0 1
TimeSpan
2 :
.
: ;
FromMinutes
; F
(
F G
$num
G I
)
I J
;
J K
}
 	
public
 
async
 
Task
 
<
 
List
 
<
 

CryptoData
 )
>
) *
>
* +)
SortByPriceChangeDescending
, G
(
G H
)
H I
{
 	
var
 

sortedData
 
=
 
_context
 %
.
% &

CryptoData
& 0
.
0 1
OrderByDescending
1 B
(
B C
crypto
C I
=>
J L
crypto
M S
.
S T
percentChange24h
T d
)
d e
.
e f
ToList
f l
(
l m
)
m n
;
n o
return
 

sortedData
 
;
 
}
 	
public
 
async
 
Task
 
<
 
List
 
<
  

CryptoData
  *
>
* +
>
+ ,'
SortByVolume24hDescending
- F
(
F G
)
G H
{
 	
var
   

sortedData
   
=
   
_context
   %
.
  % &

CryptoData
  & 0
.
  0 1
OrderByDescending
  1 B
(
  B C
crypto
  C I
=>
  J L
crypto
  M S
.
  S T
	volume24h
  T ]
)
  ] ^
.
  ^ _
ToList
  _ e
(
  e f
)
  f g
;
  g h
return
¡¡ 

sortedData
¡¡ 
;
¡¡ 
}
¢¢ 	
public
¤¤ 
async
¤¤ 
Task
¤¤ 
<
¤¤ 
List
¤¤ 
<
¤¤ 

CryptoData
¤¤ )
>
¤¤) *
>
¤¤* +
SearchCrypto
¤¤, 8
(
¤¤8 9
string
¤¤9 ?

searchTerm
¤¤@ J
)
¤¤J K
{
¥¥ 	
try
¦¦ 
{
§§ 
var
¨¨ 
searchResult
¨¨  
=
¨¨! "
await
¨¨# (
_context
¨¨) 1
.
¨¨1 2

CryptoData
¨¨2 <
.
¨¨< =
Where
¨¨= B
(
©© 
crypto
©© 
=>
©© 
crypto
©© %
.
©©% &
name
©©& *
.
©©* +
Contains
©©+ 3
(
©©3 4

searchTerm
©©4 >
)
©©> ?
||
©©@ B
crypto
©©C I
.
©©I J
symbol
©©J P
.
©©P Q
Contains
©©Q Y
(
©©Y Z

searchTerm
©©Z d
)
©©d e
)
©©e f
.
©©f g
ToListAsync
©©g r
(
©©r s
)
©©s t
;
©©t u
return
ªª 
searchResult
ªª #
;
ªª# $
}
«« 
catch
«« 
(
«« 
	Exception
«« 
ex
«« !
)
««! "
{
¬¬ 
throw
­­ 
ex
­­ 
;
­­ 
}
®® 
}
¯¯ 	
public
±± 
async
±± 
Task
±± 
<
±± 

CryptoData
±± $
>
±±$ %
GetCryptoBySymbol
±±& 7
(
±±7 8
string
±±8 >
symbol
±±? E
)
±±E F
{
²² 	
try
³³ 
{
´´ 
var
µµ 
cryptoResult
µµ  
=
µµ! "
await
µµ# (
_context
µµ) 1
.
µµ1 2

CryptoData
µµ2 <
.
µµ< =!
FirstOrDefaultAsync
µµ= P
(
µµP Q
c
µµQ R
=>
µµS U
c
µµV W
.
µµW X
symbol
µµX ^
==
µµ_ a
symbol
µµb h
)
µµh i
;
µµi j
return
¶¶ 
cryptoResult
¶¶ #
;
¶¶# $
}
·· 
catch
¸¸ 
(
¸¸ 
	Exception
¸¸ 
ex
¸¸ 
)
¸¸  
{
¹¹ 
throw
ºº 
ex
ºº 
;
ºº 
}
»» 
}
¼¼ 	
}
½½ 
}¾¾ Ì!
_/Users/artemivliev/Artem/Cryptrade/CryptradeBack/CryptocurrencyData/Services/RabbitMQService.cs
	namespace 	
CryptocurrencyData
 
. 
Services %
{ 
public 

class 
RabbitMQService  
{		 
private

 
readonly

 
IConfiguration

 '
_configuration

( 6
;

6 7
private 
IConnection 
_connection '
;' (
private 
IModel 
_channel 
;  
public 
RabbitMQService 
( 
IConfiguration -
configuration. ;
); <
{ 	
_configuration 
= 
configuration *
;* +
InitializeRabbitMQ 
( 
)  
;  !
} 	
private 
void 
InitializeRabbitMQ '
(' (
)( )
{ 	
var 
factory 
= 
new 
ConnectionFactory /
{ 
HostName 
= 
_configuration )
[) *
$str* =
]= >
,> ?
UserName 
= 
_configuration )
[) *
$str* =
]= >
,> ?
Password 
= 
_configuration )
[) *
$str* =
]= >
} 
; 
_connection 
= 
factory !
.! "
CreateConnection" 2
(2 3
)3 4
;4 5
_channel 
= 
_connection "
." #
CreateModel# .
(. /
)/ 0
;0 1
_channel!! 
.!! 
ExchangeDeclare!! $
(!!$ %
_configuration!!% 3
[!!3 4
$str!!4 K
]!!K L
,!!L M
ExchangeType!!N Z
.!!Z [
Fanout!![ a
)!!a b
;!!b c
_channel"" 
."" 
QueueDeclare"" !
(""! "
_configuration""" 0
[""0 1
$str""1 E
]""E F
,""F G
durable""H O
:""O P
true""Q U
,""U V
	exclusive""W `
:""` a
false""b g
,""g h

autoDelete""i s
:""s t
false""u z
,""z {
	arguments	""| 
:
"" 
new
"" 

Dictionary
"" 
<
"" 
string
"" 
,
"" 
object
"" ¤
>
""¤ ¥
{
""¥ ¦
{
""¦ §
$str
""¨ ¶
,
""¶ ·
$num
""¸ ¹
}
""º »
}
""» ¼
)
""¼ ½
;
""½ ¾
_channel## 
.## 
	QueueBind## 
(## 
_configuration## -
[##- .
$str##. B
]##B C
,##C D
_configuration##E S
[##S T
$str##T k
]##k l
,##l m
$str##n p
)##p q
;##q r
}$$ 	
public&& 
void&& 
PublishMessage&& "
(&&" #
string&&# )
jsonData&&* 2
)&&2 3
{'' 	
var(( 
body(( 
=(( 
Encoding(( 
.((  
UTF8((  $
.(($ %
GetBytes((% -
(((- .
jsonData((. 6
)((6 7
;((7 8
_channel)) 
.)) 
BasicPublish)) !
())! "
exchange))" *
:))* +
_configuration)), :
[)): ;
$str)); R
]))R S
,))S T

routingKey))U _
:))_ `
$str))a c
,))c d
basicProperties))e t
:))t u
null))v z
,))z {
body	))| 
:
)) 
body
)) 
)
)) 
;
)) 
}** 	
public,, 
void,, 
Dispose,, 
(,, 
),, 
{-- 	
_channel.. 
... 
Dispose.. 
(.. 
).. 
;.. 
_connection// 
.// 
Dispose// 
(//  
)//  !
;//! "
}00 	
}11 
}22 